<div th:fragment="content">
	<div class="container">
    	<h2>Brand Management</h2>
	    <button id="createNewBtn" class="btn btn-primary">Create New</button>
	    <div class="row mb-2">
	        <div class="col-md-4">
	            <form id="newBrandForm" style="display: none;">
	                <div class="form-group">
	                    <label for="name">Name</label>
	                    <input type="text" class="form-control" id="name" name="name"
	                        placeholder="Enter brand name">
	                </div>
	                <div class="form-group">
	                    <label for="description">Description</label>
	                    <input type="text" class="form-control" id="description" name="description"
	                        placeholder="Enter brand description">
	                </div>
	                <div class="form-group">
	                    <label for="imageFile">Image</label>
	                    <input type="file" class="form-control-file" id="imageFile" name="imageFile"
	                        accept="image/*">
	                </div>
	                <div class="form-group">
	                    <label for="additionalDetails">Additional Details</label>
	                    <textarea class="form-control" id="additionalDetails" name="additionalDetails" rows="3"
	                        placeholder="Enter additional details"></textarea>
	                </div>
	                <button type="submit" class="btn btn-success">Save</button>
	            </form>
	        </div>
	    </div>
	    <hr>
	    <div class="brand-table table-responsive">
	        <table class="table">
	            <thead class="thead-light">
	                <tr>
	                    <th>ID</th>
	                    <th>Name</th>
	                    <th>Image</th>
	                    <th>Description</th>
	                    <th>Additional Details</th>
	                    <th>Action</th>
	                </tr>
	            </thead>
	            <tbody id="brandTableBody">
	                <!-- Data will be dynamically populated here -->
	                <tr>
	                    <td>1</td>
	                    <td>Example Brand</td>
	                    <td>
	                        <!-- View button to open image popup -->
	                        <button class="btn btn-primary view-image-btn" data-imgurl="example.jpg">View</button>
	                    </td>
	                    <td>Brand description</td>
	                    <td>Additional details</td>
	                    <td>
	                        <!-- Edit and delete buttons -->
	                        <button class="btn btn-info edit-button">Edit</button>
	                        <button class="btn btn-danger delete-button">Delete</button>
	                    </td>
	                </tr>
	            </tbody>
	        </table>
	    </div>
	    <!-- Page navigation -->
	    <nav aria-label="Page navigation">
	        <ul class="pagination" id="paginationNav">
	            <!-- Pagination buttons will be dynamically added here -->
	        </ul>
	    </nav>
	</div>
	
	<!-- Bootstrap modal for displaying image -->
	<div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel"
	    aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="imageModalLabel">Brand Image</h5>
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                    <span aria-hidden="true">&times;</span>
	                </button>
	            </div>
	            <div class="modal-body">
	                <img src="" alt="Brand Image" class="img-fluid" id="modalImage">
	            </div>
	        </div>
	    </div>
	</div>
	<script>
	    $(document).ready(function () {
	        // Event handler for the "View" button to open image popup
	        $(document).on('click', '.view-image-btn', function () {
	            var imgUrl = $(this).data('imgurl');
	            $('#modalImage').attr('src', imgUrl);
	            $('#imageModal').modal('show');
	        });
	
	
	
	        var currentPage = 0;
	        var navTotalPages = 0;
	
	        // Function to load brand data
	        function loadData(page) {
	            $.ajax({
	                url: "/brand/all?cp=" + page,
	                type: "GET",
	                success: function (data) {
	                    // Populate grid with data
	                    populateTable(data.content);
	                    // Update current page
	                    currentPage = page;
	                    // Add pagination buttons
	                    addPaginationButtons(data.totalPages);
	                },
	                error: function (xhr, status, error) {
	                    alert('Failed to load brand data: ' + error);
	                }
	            });
	        }
	
	        // Function to populate the table with brand data
	        function populateTable(data) {
	            var tableBody = $('#brandTableBody');
	            tableBody.empty(); // Clear existing data
	
	            $.each(data, function (index, brand) {
	                var row = '<tr>' +
	                    '<td>' + brand.id + '</td>' +
	                    '<td class="editable" data-field="name" data-id="' + brand.id + '">' + brand.name + '</td>' +
	                    '<td>' +
	                    '<button class="btn btn-primary view-image-btn" data-imgurl="' + brand.imgUrl + '">View</button>' +
	                    '</td>' +
	                    '<td class="editable" data-field="description" data-id="' + brand.id + '">' + brand.description + '</td>' +
	                    '<td class="editable" data-field="additionalDetails" data-id="' + brand.id + '">' + brand.additionalDetails + '</td>' +
	                    '<td>' +
	                    '<button class="btn btn-info edit-button" data-id="' + brand.id + '">Edit</button>&nbsp;' +
	                    '<button class="btn btn-danger delete-button" data-id="' + brand.id + '">Delete</button>' +
	                    '</td>' +
	                    '</tr>';
	                tableBody.append(row);
	            });
	        }
	
	        // Function to add pagination buttons
	        function addPaginationButtons(totalPages) {
	        	navTotalPages = totalPages;
	            var paginationNav = $('#paginationNav');
	            paginationNav.empty();
	
	            // Previous button
	            var prevButton = '<li class="page-item" data-id="' + (currentPage - 1) + '"><a class="page-link" data-id="' + (currentPage - 1) + '" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>';
	            paginationNav.append(prevButton);
	
	            // Numbered buttons
	            for (var i = 0; i < totalPages; i++) {
	                var pageButton = '<li class="page-item ' + (i === currentPage ? 'active' : '') + '" data-id="' + (i) + '"><a class="page-link" data-id="' + i + '">' + (i + 1) + '</a></li>';
	                paginationNav.append(pageButton);
	            }
	
	            // Next button
	            var nextButton = '<li class="page-item" data-id="' + (currentPage + 1) + '"><a class="page-link" data-id="' + (currentPage + 1) + '" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>';
	            paginationNav.append(nextButton);
	        }
	        $('#paginationNav').on('click', '.page-item', function () {
	        	var pageClicked = $(this).data('id');
	        	console.log('page clicked: '+pageClicked);
	        	if(pageClicked<=0){
	        		pageClicked = 0;
	        		console.log('page clicked after adjust: '+pageClicked);
	        	}else if(pageClicked >= navTotalPages-1){
	        		pageClicked = navTotalPages-1;
	        		console.log('page clicked after adjust: '+pageClicked);
	        	}
	        	loadData(pageClicked);
	        });
	        // Enable inline editing
	        $('#brandTableBody').on('click', '.edit-button', function () {
	            var $row = $(this).closest('tr'); // Get the parent row
	
	            // Toggle between displaying plain text and input fields
	            $row.find('.editable').each(function () {
	                var $td = $(this);
	                var $input = $td.find('.editable-field');
	
	                // Check if the input field already exists
	                if ($input.length) {
	                    // If input field exists, switch back to displaying plain text
	                    $td.text($input.val());
	                } else {
	                    // If input field doesn't exist, create and append input field
	                    var value = $td.text().trim();
	                    var $inputField = $('<input type="text" class="editable-field">').val(value);
	                    $td.empty().append($inputField);
	                }
	            });
	
	            // Change button text to "Save"
	            $(this).text('Save').removeClass('edit-button').addClass('save-button');
	        });
	
	        // Save edited data
	        $('#brandTableBody').on('click', '.save-button', function () {
	            var $row = $(this).closest('tr');
	            var id = $row.find('.editable').data('id');
	            var newData = {};
	
	            // Collect new data from input fields
	            $row.find('.editable-field').each(function () {
	                var field = $(this).closest('.editable').data('field');
	                newData[field] = $(this).val();
	            });
	
	            // Perform AJAX request to update the brand
	            $.ajax({
	                url: '/brand/update/' + id, // Change this to your update endpoint
	                type: 'PUT',
	                contentType: 'application/json', // Specify content type as JSON
	                data: JSON.stringify(newData),   // Convert JavaScript object to JSON string
	                //data: newData,
	                success: function (response) {
	                    // Update the table with the new data if update is successful
	                    console.log(response);
	                    console.log(newData)
	                    loadData(currentPage);
	                },
	                error: function (xhr, status, error) {
	                    alert('Failed to update brand: ' + error);
	                }
	            });
	
	            // Change button text back to "Edit"
	            $(this).text('Edit').removeClass('save-button').addClass('edit-button');
	        });
	
	        // Handle deletion
	        $('#brandTableBody').on('click', '.delete-button', function () {
	            var id = $(this).data('id');
	            var confirmDelete = confirm('Are you sure you want to delete this brand?');
	
	            if (confirmDelete) {
	                // Perform AJAX request to delete the brand
	                $.ajax({
	                    url: '/brand/delete/' + id, // Change this to your delete endpoint
	                    type: 'DELETE',
	                    success: function (response) {
	                        // Remove the row from the table if deletion is successful
	                        loadData(currentPage);
	                    },
	                    error: function (xhr, status, error) {
	                        alert('Failed to delete brand: ' + error);
	                    }
	                });
	            }
	        });
	
	        // Handle new brand form submission
	        $('#newBrandForm').submit(function (event) {
	            event.preventDefault(); // Prevent the form from submitting normally
	            var formData = new FormData($(this)[0]);
	
	            $.ajax({
	                url: '/brand/save',
	                type: 'POST',
	                data: formData,
	                async: false,
	                cache: false,
	                contentType: false,
	                processData: false,
	                success: function (response) {
	                    // Handle success response
	                    console.log(response);
	                    // Empty form on success
	                    $('#newBrandForm')[0].reset();
	                    // If needed, refresh the table to display the new data
	                    loadData(currentPage);
	                },
	                error: function (xhr, status, error) {
	                    // Handle error response
	                    console.error(xhr.responseText);
	                }
	            });
	        });
	
	        // Show/hide create new brand form
	        $('#createNewBtn').click(function () {
	            $('#newBrandForm').toggle();
	        });
	
	        // Initial data load
	        loadData(currentPage);
	    });
	</script>
</div>